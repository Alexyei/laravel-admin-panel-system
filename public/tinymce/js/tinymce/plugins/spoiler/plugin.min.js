tinymce.PluginManager.add("spoiler",function(e,o){var t=e.$;e.contentCSS.push(o+"/css/spoiler.css");var i=e.getParam("spoiler_caption","Спойлер");function n(){var o=e.selection;o.getNode()&&(e.undoManager.transact(function(){var e=o.getContent();e||(e="Spoiler text."),o.setContent('<div class="spoiler"><div class="spoiler-header">'+i+' </div><div class="spoiler-text">'+e+"</div></div>")}),e.nodeChanged())}function s(){var o=e.selection.getNode();o&&"spoiler"==o.className&&(e.undoManager.transact(function(){var e=document.createElement("p");e.innerHTML=o.getElementsByClassName("spoiler-text")[0].innerHTML,o.parentNode.replaceChild(e,o)}),e.nodeChanged())}5==tinymce.majorVersion&&(e.ui.registry.addIcon("removespoiler",'<svg width="24" height="24"><use xlink:href="'+o+'/img/spoiler_icons.svg#addspoiler"></use></svg>'),e.ui.registry.addIcon("addspoiler",'<svg width="24" height="24"><use xlink:href="'+o+'/img/spoiler_icons.svg#removespoiler"></use></svg>')),e.on("PreProcess",function(e){t('div[class*="spoiler"]',e.node).each(function(e,o){o.hasAttribute("contenteditable")&&o.removeAttribute("contentEditable")})}),e.on("SetContent",function(){t('div[class*="spoiler"]').each(function(e,o){if(!o.hasAttribute("contenteditable")){var i=t(o);i.hasClass("spoiler")?o.contentEditable=!1:i.hasClass("spoiler-text")&&(o.contentEditable=!0)}})}),4==tinymce.majorVersion?(e.addButton("spoiler-add",{tooltip:"Add spoiler",image:o+"/img/eye-plus.png",onclick:n}),e.addMenuItem("spoiler-add",{text:"Add spoiler",context:"format",onclick:n}),e.addButton("spoiler-remove",{tooltip:"Remove spoiler",image:o+"/img/eye-blocked.png",onclick:s}),e.addMenuItem("spoiler-remove",{text:"Remove spoiler",context:"format",onclick:s})):(e.ui.registry.addButton("spoiler-add",{tooltip:"Add spoiler",icon:"addspoiler",onAction:n}),e.ui.registry.addMenuItem("spoiler-add",{text:"Add spoiler",context:"format",onAction:n}),e.ui.registry.addButton("spoiler-remove",{tooltip:"Remove spoiler",icon:"removespoiler",onAction:s}),e.ui.registry.addMenuItem("spoiler-remove",{text:"Remove spoiler",context:"format",onAction:s}))});
